% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/inla_model_functions.R
\name{evaluate_preds}
\alias{evaluate_preds}
\title{Evaluate model performance based on predicted vs observed count}
\usage{
evaluate_preds(pred, mod, sp_code, analysis_data)
}
\arguments{
\item{pred}{prediction data frame}

\item{mod}{fitted model}

\item{sp_code}{species code}

\item{analysis_data}{list containing analysis data, including \code{full_count_matrix}}
}
\value{
data frame of performance metrics
}
\description{
Compare predicted median abundance to observed count. Also summarise CRPS and log score if available
}
\examples{

test_dat <- readRDS(system.file("extdata", "analysis_data_test.rds", package = "birdDistribution"))

test_dat$all_surveys$Obs_Index <- 1:nrow(test_dat$all_surveys)

# Using km for projection units because it helps with INLA model calculations to have smaller numbers
AEA_proj <- "+proj=aea +lat_1=50 +lat_2=70 +lat_0=40 +lon_0=-106 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=km +no_defs "

# takes awhile to run
if(FALSE){
# train on old data
  mod <- fit_inla(
    sp_code = test_dat$species_to_model$Species_Code_BSC[1],
    analysis_data = test_dat,
    proj_use = AEA_proj,
    study_poly = test_area,
    covariates = cov_df,
    mod_dir = tempdir(),
    save_mod = FALSE,
    train_dat_filter = "Date_Time < lubridate::ymd('2010-05-01')"
  )
# Predict on new data
  pred <- predict_inla(
    dat = test_dat$all_surveys \%>\% filter(Date_Time >= lubridate::ymd('2010-05-01')),
    analysis_data = test_dat,
    mod = mod,
    sp_code = test_dat$species_to_model$Species_Code_BSC[1],
    covariates = cov_df,
    do_crps = TRUE
  )

evaluate_preds(pred \%>\% mutate(Crossval_Fold = 1), mod,
               sp_code = test_dat$species_to_model$Species_Code_BSC[1],
               test_dat)
}

}
